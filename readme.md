Telegram-бот «Тайный Санта»
Бот для автоматизации игры «Тайный Санта» в компании с хранением данных в Google Sheets и возможностью рассылок и опросов.​

Возможности
Регистрация участников через Telegram (/start, форма с ФИО, отделом и телефоном).​

Валидация участников администраторами с подтверждением или отклонением заявки.​

Автоматическая жеребьёвка по кольцевой схеме с исключением самодарения.​

Личные уведомления каждому участнику о его получателе подарка.​

Массовые рассылки участникам


Используемый стек
Python 3.10+.​

Telegram-бот: aiogram 3.x 

Google Sheets: gspread + google-auth или google-api-python-client.​

Конфигурация: переменные окружения / .env (через python-dotenv).​

Логирование: стандартный модуль logging.​


Подготовка Google Sheets
Создайте в Google Sheets таблицу с минимум тремя листами:

Participants — участники.​

Polls — ответы на опросы.​

Achievements — достижения (если используется геймификация).​
Пока в разработке, возможно сделаю к следующему новому году.

Лист Participants должен содержать столбцы в фиксированном порядке

не переименовывайте


Настройка доступа к Google API
В Google Cloud Console создайте сервисный аккаунт и выдайте ему роль с правами редактирования Google Sheets.​

Скачайте JSON-ключ сервисного аккаунта.​

Дайте этому аккаунту права «Редактор» на вашу таблицу Google Sheets по e-mail сервисного аккаунта.​

Путь к JSON-файлу или его содержимое в Base64 задайте через переменные окружения (см. ниже).​

Переменные окружения
Создайте .env или задайте переменные окружения (названия подправьте под реализацию):

BOT_TOKEN — токен Telegram-бота.

ADMIN_IDS — список Telegram ID администраторов (через запятую).​

ADMIN_CHAT_ID - id канала где бот должен быть добавле в качестве администратора, сюда будут приходить сообщения с валидацией
участникво, и те пользователи кто добавлен в админы бота могут подверждать участие.

GOOGLE_SHEETS_ID — ID таблицы Google Sheets.​

GOOGLE_SERVICE_ACCOUNT_JSON или GOOGLE_SERVICE_ACCOUNT_JSON_B64 — путь к JSON ключу или содержимое Base64.​

Дополнительные параметры: флаги включения геймификации, интеграции с n8n и т.п.​
(в разработке)


Установите зависимости:

bash
pip install -r requirements.txt
Заполните .env или экспортируйте переменные окружения.

Запустите бота:

bash
python -m bot
(или другую entrypoint-команду в зависимости от структуры проекта.)


Основные команды
Для участников
/start — описание игры и регистрация / обновление данных.​
​

Для администраторов
Список admin_ids задаётся в конфигурации.​

/admin — краткое меню администратора.​


Логика жеребьёвки
В жеребьёвке участвуют только участники с active = TRUE и validated = TRUE.​

Бот перемешивает список участников и строит пары по кольцевой схеме: каждый дарит следующему, последний — первому.​

Для каждого участника записываются recipient_tg_id, recipient_name, recipient_info и notified = FALSE.​

Интеграция с n8n (в разработке)
Бот пишет все данные в Google Sheets, а n8n может:​

Делать рассылки по расписанию и отправлять напоминания через Telegram, email и др.​

Формировать отчёты для администраторов.​ и так далее=)